---
###############################################################################
# Heating Control System Configuration
###############################################################################
# Configuration for Python-based heating control with pluggable controller
# architecture (PID or ON/OFF) and multi-zone management
###############################################################################

# MQTT Topics
boiler_control_topic: "zigbee2mqtt/Boiler Heat Request Switch"
heartbeat_topic: "boiler_heat_request/heartbeat"
outside_temperature_topic: "zigbee2mqtt/Outdoor Sensor"

# Control Loop Settings
control_interval_seconds: 30  # How often to run control loop (30 sec)
heartbeat_interval_seconds: 300  # Heartbeat every 5 minutes (must be < Shelly auto-off of 10 min)

# Heating Zones Configuration
zones:
  ground_floor:
    # Temperature Sensor
    temperature_sensor_topic: "zigbee2mqtt/Living Room Sensor"

    # Pump Control
    pump_control_topic: "zigbee2mqtt/Pump UFH Ground Floor"

    # Setpoints
    default_setpoint: 20.0  # Default target temperature (°C)
    min_setpoint: 18.0      # Minimum allowed setpoint
    max_setpoint: 23.0      # Maximum allowed setpoint

    # Controller Type: "pid" or "onoff"
    controller_type: "onoff"  # Use PID controller for smooth regulation

    # PID Controller Tuning (only used if controller_type = "pid")
    # kp: Proportional gain - how aggressively to respond to current error
    # ki: Integral gain - how much to account for accumulated error
    # kd: Derivative gain - how much to dampen based on rate of change
    pid_kp: 5.0   # Higher = more aggressive heating
    pid_ki: 0.1   # Higher = faster correction of steady-state error
    pid_kd: 1.0   # Higher = more damping of oscillations

    # ON/OFF Controller Tuning (only used if controller_type = "onoff")
    hysteresis: 0.2  # Temperature dead-band in °C (prevents rapid cycling)

  first_floor:
    # Temperature Sensor
    temperature_sensor_topic: "zigbee2mqtt/First Floor Sensor"

    # Pump Control
    pump_control_topic: "zigbee2mqtt/Pump UFH First Floor"

    # Setpoints
    default_setpoint: 19.0  # Slightly cooler upstairs
    min_setpoint: 17.0
    max_setpoint: 22.0

    # Controller Type: "pid" or "onoff"
    controller_type: "onoff"  # Use PID controller for smooth regulation

    # PID Controller Tuning (only used if controller_type = "pid")
    pid_kp: 5.0
    pid_ki: 0.1
    pid_kd: 1.0

    # ON/OFF Controller Tuning (only used if controller_type = "onoff")
    hysteresis: 0.2  # Temperature dead-band in °C (prevents rapid cycling)

###############################################################################
# PID Tuning Guidelines
###############################################################################
# Start with conservative values and tune based on system response:
#
# If temperature oscillates:
#   - Reduce kp (less aggressive)
#   - Increase kd (more damping)
#
# If temperature takes too long to reach setpoint:
#   - Increase kp (more aggressive)
#   - Increase ki (faster steady-state correction)
#
# If temperature overshoots setpoint:
#   - Reduce kp
#   - Increase kd
#
# If steady-state error persists (never quite reaches setpoint):
#   - Increase ki
#
# Recommended starting points for hydronic heating:
#   kp: 3.0 - 7.0
#   ki: 0.05 - 0.2
#   kd: 0.5 - 2.0
###############################################################################

###############################################################################
# Controller Type Selection
###############################################################################
# Choose between two control strategies:
#
# 1. PID Controller (controller_type: "pid")
#    - Smooth, continuous control
#    - Prevents temperature oscillations
#    - Best for systems with slow thermal response (underfloor heating)
#    - Requires tuning (kp, ki, kd parameters)
#
# 2. ON/OFF Controller (controller_type: "onoff")
#    - Simple bang-bang control with hysteresis
#    - More predictable behavior
#    - Easier to understand and configure
#    - Good for faster-responding systems (radiators)
#    - Only requires hysteresis parameter
#
# Default: "pid" for underfloor heating systems
###############################################################################
